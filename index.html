<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تطبيق الدردشة</title>
    <style>
        /* تنسيقات الصفحة الرئيسية */
body {
    font-family: Arial, sans-serif;
    background-color: #f0f2f5;
    margin: 0;
    padding: 0;
}

#main-page {
    padding: 20px;
}

h2 {
    text-align: center;
}

#groups-list {
    list-style: none;
    padding: 0;
}

#groups-list li {
    background-color: #fff;
    padding: 10px;
    margin: 10px 0;
    border-radius: 8px;
    display: flex;
    align-items: center;
    cursor: pointer;
}

#groups-list img {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    margin-right: 10px;
}

#add-group-button {
    background-color: #1877f2;
    color: white;
    padding: 10px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 16px;
    display: block;
    margin: 20px auto;
    width: 200px;
}

/* تنسيقات صفحة إنشاء القروب */
#create-group-page {
    padding: 20px;
}

label {
    display: block;
    margin: 10px 0 5px;
}

input, textarea, button {
    width: 100%;
    padding: 10px;
    margin-bottom: 10px;
    border-radius: 8px;
    border: 1px solid #ccc;
}

button[type="submit"] {
    background-color: #1877f2;
    color: white;
    cursor: pointer;
}

/* تنسيقات صفحة الدردشة */
#chat-page {
    padding: 20px;
}

#group-header {
    display: flex;
    align-items: center;
}

#chat-group-photo {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    margin-right: 10px;
}

#messages-list {
    list-style: none;
    padding: 0;
    margin: 20px 0;
}

#messages-list li {
    margin-bottom: 10px;
    padding: 10px;
    border-radius: 8px;
    max-width: 60%;
}

#messages-list li.my-message {
    background-color: #dcf8c6;
    align-self: flex-end;
}

#messages-list li.other-message {
    background-color: #fff;
    align-self: flex-start;
}

#message-input-area {
    display: flex;
    align-items: center;
}

#message-input {
    flex: 1;
    padding: 10px;
    border-radius: 8px;
    border: 1px solid #ccc;
}

#send-button {
    background-color: #1877f2;
    color: white;
    padding: 10px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    margin-left: 10px;
}

    </style>
</head>
<body>
    <div id="main-page">
        <h2>قائمة القروبات</h2>
        <ul id="groups-list">
            <!-- سيتم إدراج القروبات هنا -->
        </ul>
        <button id="add-group-button">+ إنشاء قروب جديد</button>
    </div>

    <!-- صفحة إنشاء القروب -->
    <div id="create-group-page" style="display:none;">
        <h2>إنشاء قروب جديد</h2>
        <form id="create-group-form">
            <label for="group-name">اسم القروب:</label>
            <input type="text" id="group-name" required>
            <label for="group-photo">صورة بروفايل القروب (اختياري):</label>
            <input type="file" id="group-photo" accept="image/*">
            <label for="group-description">نبذه عن القروب:</label>
            <textarea id="group-description" required></textarea>
            <label for="group-users-count">عدد المستخدمين:</label>
            <input type="number" id="group-users-count" required>
            <div id="users-info">
                <!-- سيتم إدراج حقول معلومات المستخدمين هنا -->
            </div>
            <button type="submit">إنشاء</button>
        </form>
    </div>

    <!-- صفحة الدردشة -->
    <div id="chat-page" style="display:none;">
        <div id="group-header">
            <img id="chat-group-photo" src="" alt="Group Photo">
            <h2 id="chat-group-name"></h2>
        </div>
        <ul id="messages-list">
            <!-- سيتم إدراج الرسائل هنا -->
        </ul>
        <div id="message-input-area">
            <input type="text" id="message-input" placeholder="اكتب رسالة...">
            <button id="send-button">إرسال</button>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
  // تحميل القروبات من Local Storage
  let groups = JSON.parse(localStorage.getItem("groups")) || [];

  const groupListElement = document.getElementById("group-list");
  const addGroupBtn = document.getElementById("add-group-btn");

  // عرض القروبات في القائمة
  function displayGroups() {
    groupListElement.innerHTML = "";
    groups.forEach((group, index) => {
      const groupElement = document.createElement("div");
      groupElement.className = "group";
      groupElement.innerHTML = `
        <img src="${group.image}" alt="${group.name}" class="group-image">
        <span class="group-name">${group.name}</span>
      `;
      groupElement.addEventListener("click", () => openChat(index));
      groupElement.addEventListener("contextmenu", (e) => {
        e.preventDefault();
        showGroupOptions(index);
      });
      groupListElement.appendChild(groupElement);
    });
  }

  // فتح الدردشة للقروب
  function openChat(groupIndex) {
    const group = groups[groupIndex];
    const chatElement = document.getElementById("chat");
    const groupHeaderElement = document.getElementById("group-header");
    const chatMessagesElement = document.getElementById("chat-messages");
    const sendMessageBtn = document.getElementById("send-message-btn");
    const messageInput = document.getElementById("message-input");

    chatMessagesElement.innerHTML = "";

    groupHeaderElement.innerHTML = `
      <img src="${group.image}" alt="${group.name}" class="group-image">
      <span class="group-name">${group.name}</span>
    `;
    groupHeaderElement.addEventListener("mousedown", (e) => {
      if (e.which === 1) {
        // إذا ضغط على الصورة لمدة 10 ثوانٍ، أظهر قائمة الحسابات
        setTimeout(() => showAccountSwitchOptions(groupIndex), 10000);
      }
    });

    group.messages.forEach((message) => {
      const messageElement = document.createElement("div");
      messageElement.className = message.sender.isOwner ? "message owner" : "message";
      messageElement.innerHTML = `
        <div class="message-info">
          <span class="message-sender">${message.sender.name} ${message.sender.isOwner ? "(المالك)" : message.sender.isModerator ? "(مشرف)" : ""}</span>
          <span class="message-timestamp" title="Edit">${message.timestamp}</span>
        </div>
        <div class="message-text">${message.text}</div>
        <img src="${message.sender.image}" alt="${message.sender.name}" class="user-image">
      `;
      messageElement.querySelector(".message-timestamp").addEventListener("mousedown", (e) => {
        if (e.which === 1) {
          // إذا ضغط على الوقت لمدة 10 ثوانٍ، اسمح بتعديل الوقت
          setTimeout(() => editMessageTimestamp(message), 10000);
        }
      });
      chatMessagesElement.appendChild(messageElement);
    });

    sendMessageBtn.onclick = function () {
      const message = {
        text: messageInput.value,
        sender: group.currentUser,
        timestamp: new Date().toLocaleString(),
        read: false,
      };
      group.messages.push(message);
      saveGroups();
      openChat(groupIndex);
      messageInput.value = "";
    };
  }

  // حفظ القروبات في Local Storage
  function saveGroups() {
    localStorage.setItem("groups", JSON.stringify(groups));
  }

  // إنشاء قروب جديد
  addGroupBtn.onclick = function () {
    const groupName = prompt("أدخل اسم القروب:");
    const groupImage = prompt("أدخل رابط صورة بروفايل القروب (اختياري):");
    const groupDescription = prompt("أدخل نبذة عن القروب:");
    const groupUsersCount = parseInt(prompt("أدخل عدد المستخدمين:"));
    const users = [];

    for (let i = 0; i < groupUsersCount; i++) {
      const userName = prompt(`أدخل اسم المستخدم ${i + 1}:`);
      const userImage = prompt(`أدخل رابط صورة المستخدم ${i + 1} (اختياري):`);
      const userCountry = prompt(`أدخل بلد المستخدم ${i + 1}:`);
      const userDescription = prompt(`أدخل نبذة عن المستخدم ${i + 1}:`);
      const isOwner = confirm(`هل المستخدم ${userName} هو المالك؟`);
      const isModerator = confirm(`هل المستخدم ${userName} هو مشرف؟`);

      users.push({
        name: userName,
        image: userImage || "default_user.png",
        country: userCountry,
        description: userDescription,
        isOwner: isOwner,
        isModerator: isModerator,
      });
    }

    const group = {
      name: groupName,
      image: groupImage || `https://via.placeholder.com/150x150.png?text=${groupName.charAt(0)}+${groupName.charAt(groupName.length - 1)}`,
      description: groupDescription,
      users: users,
      messages: [],
      currentUser: users.find(user => user.isOwner) || users[0],
    };

    groups.push(group);
    saveGroups();
    displayGroups();
  };

  // عرض خيارات الحسابات لتبديل المستخدم
  function showAccountSwitchOptions(groupIndex) {
    const group = groups[groupIndex];
    let options = "اختر حسابًا للدردشة:\n";
    group.users.forEach((user, index) => {
      options += `${index + 1}. ${user.name} (${user.isOwner ? "المالك" : user.isModerator ? "مشرف" : "مستخدم"})\n`;
    });
    const selectedUserIndex = parseInt(prompt(options)) - 1;
    group.currentUser = group.users[selectedUserIndex];
    saveGroups();
    openChat(groupIndex);
  }

  // عرض خيارات تعديل أو حذف القروب
  function showGroupOptions(groupIndex) {
    const group = groups[groupIndex];
    const option = prompt("اختر خيارًا:\n1. تعديل القروب\n2. حذف القروب");

    if (option === "1") {
      editGroup(groupIndex);
    } else if (option === "2") {
      if (confirm(`هل أنت متأكد أنك تريد حذف القروب "${group.name}"؟`)) {
        groups.splice(groupIndex, 1);
        saveGroups();
        displayGroups();
      }
    }
  }

  // تعديل القروب
  function editGroup(groupIndex) {
    const group = groups[groupIndex];
    const groupName = prompt("أدخل اسم القروب:", group.name);
    const groupImage = prompt("أدخل رابط صورة بروفايل القروب (اختياري):", group.image);
    const groupDescription = prompt("أدخل نبذة عن القروب:", group.description);
    const groupUsersCount = parseInt(prompt("أدخل عدد المستخدمين:", group.users.length));
    const users = [];

    for (let i = 0; i < groupUsersCount; i++) {
      const user = group.users[i] || {};
      const userName = prompt(`أدخل اسم المستخدم ${i + 1}:`, user.name || "");
      const userImage = prompt(`أدخل رابط صورة المستخدم ${i + 1} (اختياري):`, user.image || "");
      const userCountry = prompt(`أدخل بلد المستخدم ${i + 1}:`, user.country || "");
      const userDescription = prompt(`أدخل نبذة عن المستخدم ${i + 1}:`, user.description || "");
      const isOwner = confirm(`هل المستخدم ${userName} هو المالك؟`);
      const isModerator = confirm(`هل المستخدم ${userName} هو مشرف؟`);

      users.push({
        name: userName,
        image: userImage || "default_user.png",
        country: userCountry,
        description: userDescription,
        isOwner: isOwner,
        isModerator: isModerator,
      });
    }

    group.name = groupName;
    group.image = groupImage || `https://via.placeholder.com/150x150.png?text=${groupName.charAt(0)}+${groupName.charAt(groupName.length - 1)}`;
    group.description = groupDescription;
    group.users = users;

    saveGroups();
    displayGroups();
    openChat(groupIndex);
  }

  // تعديل تاريخ ووقت الرسالة
  function editMessageTimestamp(message) {
    const newTimestamp = prompt("أدخل الوقت والتاريخ الجديد:", message.timestamp);
    if (newTimestamp) {
      message.timestamp = newTimestamp;
      saveGroups();
      openChat(groups.findIndex(group => group.messages.includes(message)));
    }
  }

  // عرض القروبات عند تحميل الصفحة
  displayGroups();
});

    </script>
</body>
</html>
